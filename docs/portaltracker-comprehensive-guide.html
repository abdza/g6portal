<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortalTracker Domain - Comprehensive Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            .field-list {
                grid-template-columns: 1fr;
            }
            .tracker-types {
                grid-template-columns: 1fr;
            }
        }
        .header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .toc {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #007bff;
            margin-bottom: 30px;
        }
        .toc h2 {
            margin-top: 0;
            color: #007bff;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        .toc li:before {
            content: "▶";
            color: #007bff;
            position: absolute;
            left: 0;
        }
        .toc a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
        }
        .toc a:hover {
            color: #007bff;
        }
        h1, h2, h3 {
            color: #007bff;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 50px;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        h3 {
            margin-top: 35px;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        p {
            margin-bottom: 15px;
        }
        .domain-class {
            background: #f8f9fa;
            border-left: 5px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .domain-class h4 {
            margin-top: 0;
            color: #28a745;
            font-size: 1.3em;
        }
        .field-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .field-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .field-name {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .field-type {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .field-desc {
            margin-top: 12px;
            font-size: 0.95em;
            line-height: 1.4;
        }
        .flow-diagram {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #007bff;
            border-radius: 10px;
            text-align: center;
        }
        .flow-step {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            font-weight: bold;
        }
        .flow-arrow {
            font-size: 1.5em;
            color: #007bff;
            margin: 0 10px;
        }
        .integration-point {
            background: #f8f9fa;
            border: 2px solid #007bff;
            border-left: 5px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .integration-point h5 {
            margin: 0 0 10px 0;
            color: #007bff;
            font-weight: bold;
        }
        .code-block {
            background: #f8f9fa;
            color: #212529;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 20px 0;
            border: 2px solid #e9ecef;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 14px;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid #ffeaa7;
        }
        .warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .tracker-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .tracker-type {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .tracker-type.tracker {
            border-color: #28a745;
            background: #f8fff8;
        }
        .tracker-type.statement {
            border-color: #ffc107;
            background: #fffef8;
        }
        .tracker-type.datastore {
            border-color: #17a2b8;
            background: #f8fdff;
        }
        .tracker-type h4 {
            margin: 0 0 15px 0;
            font-size: 1.4em;
        }
        .tracker.h4 { color: #28a745; }
        .statement.h4 { color: #ffc107; }
        .datastore.h4 { color: #17a2b8; }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }
        .feature-list li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        .architecture-diagram {
            text-align: center;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
            border: 2px solid #dee2e6;
        }
        .layer {
            background: white;
            margin: 10px auto;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 80%;
        }
        .layer.controller { border-left: 5px solid #dc3545; }
        .layer.service { border-left: 5px solid #fd7e14; }
        .layer.domain { border-left: 5px solid #007bff; }
        .layer.database { border-left: 5px solid #6c757d; }
    </style>
</head>
<body>
    <div class="header">
        <h1>PortalTracker Domain</h1>
        <p>Comprehensive Technical Documentation & Integration Guide</p>
    </div>

    <div class="container">
        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. System Overview</a></li>
                <li><a href="#architecture">2. Architecture & Data Flow</a></li>
                <li><a href="#domain-classes">3. Domain Classes</a></li>
                <li><a href="#tracker-types">4. Tracker Types</a></li>
                <li><a href="#field-types">5. Field Types & Validation</a></li>
                <li><a href="#workflow">6. Workflow & Transitions</a></li>
                <li><a href="#integration">7. PortalPage Integration</a></li>
                <li><a href="#data-management">8. Data Management</a></li>
                <li><a href="#security">9. Security & Access Control</a></li>
                <li><a href="#api">10. API & Services</a></li>
                <li><a href="#best-practices">11. Best Practices</a></li>
                <li><a href="#troubleshooting">12. Troubleshooting</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 id="overview">1. System Overview</h2>
        
        <p>PortalTracker is a comprehensive dynamic data tracking and workflow management system built on Grails. It provides a flexible framework for creating database-backed forms, workflows, and data management systems without hardcoding database schemas.</p>

        <div class="info">
            <strong>Key Capabilities:</strong>
            <ul class="feature-list">
                <li>Dynamic table creation and field management</li>
                <li>Three distinct tracker types for different use cases</li>
                <li>Built-in audit trails and status transitions</li>
                <li>Role-based access control and data filtering</li>
                <li>Excel import/export capabilities</li>
                <li>Email notifications on status changes</li>
                <li>Search and filtering with security validation</li>
                <li>SQL injection protection with parameterized queries</li>
            </ul>
        </div>

        <h3>Core Components</h3>
        
        <div class="tracker-types">
            <div class="tracker-type tracker">
                <h4>Tracker</h4>
                <p><strong>Full Workflow System</strong></p>
                <p>Complete audit trail, record status tracking, role-based transitions, and comprehensive workflow management.</p>
                <ul class="feature-list">
                    <li>Status transitions</li>
                    <li>Audit trail table</li>
                    <li>Role-based permissions</li>
                    <li>Email notifications</li>
                    <li>File attachments</li>
                </ul>
            </div>
            
            <div class="tracker-type statement">
                <h4>Statement</h4>
                <p><strong>Role-Based Data</strong></p>
                <p>Simplified system with role-based access control but without complex workflow transitions.</p>
                <ul class="feature-list">
                    <li>Role-based access</li>
                    <li>Basic data management</li>
                    <li>No audit trail</li>
                    <li>Simpler permissions</li>
                </ul>
            </div>
            
            <div class="tracker-type datastore">
                <h4>DataStore</h4>
                <p><strong>Simple Data Storage</strong></p>
                <p>Basic data storage without roles or workflows - pure data repository functionality.</p>
                <ul class="feature-list">
                    <li>Simple data storage</li>
                    <li>No roles or permissions</li>
                    <li>No audit trail</li>
                    <li>Direct data access</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 id="architecture">2. Architecture & Data Flow</h2>
        
        <div class="architecture-diagram">
            <h3>System Architecture Layers</h3>
            
            <div class="layer controller">
                <strong>Controller Layer</strong><br>
                PortalTrackerController, PortalTrackerDataController, etc.<br>
                <em>Handles HTTP requests, user interactions, and response rendering</em>
            </div>
            
            <div class="layer service">
                <strong>Service Layer</strong><br>
                PortalTrackerService, PortalTrackerFieldService, etc.<br>
                <em>Business logic, data validation, and processing</em>
            </div>
            
            <div class="layer domain">
                <strong>Domain Layer</strong><br>
                PortalTracker, PortalTrackerField, PortalTrackerStatus, etc.<br>
                <em>Data models, relationships, and domain logic</em>
            </div>
            
            <div class="layer database">
                <strong>Database Layer</strong><br>
                Dynamic tables: trak_{module}_{slug}_data, trak_{module}_{slug}_updates<br>
                <em>PostgreSQL/SQL Server with dynamically created schemas</em>
            </div>
        </div>

        <h3>Data Flow Process</h3>
        
        <div class="flow-diagram">
            <div class="flow-step">Create Tracker</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Define Fields</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Setup Workflow</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Configure Roles</div>
            <br><br>
            <div class="flow-step">Data Entry</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Validation</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Status Transition</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Notifications</div>
        </div>

        <h3>Database Schema Generation</h3>
        <p>PortalTracker automatically creates database tables based on tracker configuration:</p>
        
        <div class="code-block">
<strong>Data Table:</strong> trak_{module}_{slug}_data
- id (Primary Key)
- dataupdate_id (Links to PortalTrackerData)
- record_status (For Tracker/Statement types)
- {dynamic_fields} (Based on PortalTrackerField definitions)

<strong>Audit Table:</strong> trak_{module}_{slug}_updates (Tracker type only)
- id (Primary Key)
- record_id (Links to data table)
- description (Update description)
- update_date (Timestamp)
- updater_id (User who made the update)
- status (Status at time of update)
- changes (JSON of field changes)
- attachment_id (Optional file attachment)
- allowedroles (Visibility control)
        </div>
    </div>

    <div class="container">
        <h2 id="domain-classes">3. Domain Classes</h2>
        
        <div class="domain-class">
            <h4>PortalTracker</h4>
            <p><strong>Core domain class</strong> - The main tracker configuration and management entity</p>
            <p><em>Location:</em> grails-app/domain/g6portal/PortalTracker.groovy:28</p>
            
            <div class="field-list">
                <div class="field-item">
                    <div class="field-name">Basic Properties</div>
                    <div class="field-desc">name, slug, tracker_type, module, side_menu</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Access Control</div>
                    <div class="field-desc">allowedroles, allowadd, anonymous_list, anonymous_view, require_login</div>
                </div>
                <div class="field-item">
                    <div class="field-name">UI Configuration</div>
                    <div class="field-desc">listfields, hiddenlistfields, excelfields, filterfields, searchfields</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Database Settings</div>
                    <div class="field-desc">datatable, trailtable, condition_q</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Workflow</div>
                    <div class="field-desc">initial_status, defaultfield, postprocess (PortalPage)</div>
                </div>
            </div>
        </div>
        
        <div class="domain-class">
            <h4>PortalTrackerField</h4>
            <p><strong>Field definitions</strong> - Defines individual form fields and database columns</p>
            <p><em>Location:</em> grails-app/domain/g6portal/PortalTrackerField.groovy:20</p>
            
            <div class="field-list">
                <div class="field-item">
                    <div class="field-name">Field Definition</div>
                    <div class="field-desc">name, label, field_type</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Configuration</div>
                    <div class="field-desc">field_options, field_format, field_default</div>
                </div>
                <div class="field-item">
                    <div class="field-name">UI Enhancement</div>
                    <div class="field-desc">hyperscript, classes, hide_heading</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Security</div>
                    <div class="field-desc">is_encrypted, role_query, encode_exception</div>
                </div>
            </div>
        </div>
        
        <div class="domain-class">
            <h4>PortalTrackerStatus</h4>
            <p><strong>Workflow states</strong> - Defines different states in the tracker workflow</p>
            <p><em>Location:</em> grails-app/domain/g6portal/PortalTrackerStatus.groovy:3</p>
            
            <div class="field-list">
                <div class="field-item">
                    <div class="field-name">Status Definition</div>
                    <div class="field-desc">name, displayfields, flow</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Permissions</div>
                    <div class="field-desc">editroles, updateable, updateallowedroles</div>
                </div>
                <div class="field-item">
                    <div class="field-name">UI Control</div>
                    <div class="field-desc">editfields, attachable, suppressupdatebutton</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Notifications</div>
                    <div class="field-desc">emailonupdate (PortalTrackerEmail)</div>
                </div>
            </div>
        </div>
        
        <div class="domain-class">
            <h4>PortalTrackerTransition</h4>
            <p><strong>Workflow transitions</strong> - Defines how users can move between statuses</p>
            <p><em>Location:</em> grails-app/domain/g6portal/PortalTrackerTransition.groovy:5</p>
            
            <div class="field-list">
                <div class="field-item">
                    <div class="field-name">Transition Definition</div>
                    <div class="field-desc">name, display_name, prev_status, next_status</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Field Control</div>
                    <div class="field-desc">editfields, displayfields, requiredfields, richtextfields</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Logic & Validation</div>
                    <div class="field-desc">enabledcondition, updatetrails, postprocess</div>
                </div>
                <div class="field-item">
                    <div class="field-name">UI Customization</div>
                    <div class="field-desc">submitbuttontext, cancelbuttontext, immediate_submission</div>
                </div>
            </div>
        </div>
        
        <div class="domain-class">
            <h4>PortalTrackerData</h4>
            <p><strong>Data import management</strong> - Handles Excel/file uploads and batch processing</p>
            <p><em>Location:</em> grails-app/domain/g6portal/PortalTrackerData.groovy:8</p>
            
            <div class="field-list">
                <div class="field-item">
                    <div class="field-name">File Management</div>
                    <div class="field-desc">path, file_link, date_created</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Processing</div>
                    <div class="field-desc">header_start, header_end, data_row, data_end</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Status Tracking</div>
                    <div class="field-desc">uploaded, uploadStatus, messages</div>
                </div>
                <div class="field-item">
                    <div class="field-name">Configuration</div>
                    <div class="field-desc">savedparams, send_email, sent_email_date</div>
                </div>
            </div>
        </div>
        
        <div class="domain-class">
            <h4>Supporting Classes</h4>
            <ul class="feature-list">
                <li><strong>PortalTrackerRole</strong> - Role definitions and data comparison rules</li>
                <li><strong>PortalTrackerEmail</strong> - Email templates and notifications</li>
                <li><strong>PortalTrackerFlow</strong> - Flow definitions for complex workflows</li>
                <li><strong>PortalTrackerError</strong> - Field validation and error checking</li>
                <li><strong>PortalTrackerIndex</strong> - Database indexing configuration</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 id="tracker-types">4. Tracker Types Deep Dive</h2>
        
        <h3>Tracker Type: "Tracker" (Full Workflow)</h3>
        <div class="info">
            <p><strong>Use Cases:</strong> Document approvals, ticket systems, project management, compliance workflows</p>
            <p><strong>Features:</strong></p>
            <ul class="feature-list">
                <li>Complete audit trail with trak_{module}_{slug}_updates table</li>
                <li>Status-based workflow with transitions</li>
                <li>Role-based permissions per transition</li>
                <li>Email notifications on status changes</li>
                <li>File attachments on updates</li>
                <li>Historical tracking of all changes</li>
            </ul>
        </div>
        
        <h3>Tracker Type: "Statement" (Role-Based)</h3>
        <div class="info">
            <p><strong>Use Cases:</strong> Reports, dashboards, role-specific data views</p>
            <p><strong>Features:</strong></p>
            <ul class="feature-list">
                <li>Role-based data access without workflows</li>
                <li>Record status field for basic categorization</li>
                <li>No audit trail table created</li>
                <li>Simplified permissions model</li>
                <li>Faster performance for read-heavy operations</li>
            </ul>
        </div>
        
        <h3>Tracker Type: "DataStore" (Simple Storage)</h3>
        <div class="info">
            <p><strong>Use Cases:</strong> Configuration data, lookup tables, simple forms</p>
            <p><strong>Features:</strong></p>
            <ul class="feature-list">
                <li>Pure data storage without roles or workflows</li>
                <li>No record_status field</li>
                <li>Direct data access</li>
                <li>Minimal overhead for high-performance scenarios</li>
                <li>Suitable for API-driven applications</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 id="field-types">5. Field Types & Validation</h2>
        
        <p>PortalTracker supports 17 different field types, each with specific database mappings and UI behaviors:</p>
        
        <div class="field-list">
            <div class="field-item">
                <div class="field-name">Text</div>
                <div class="field-type">varchar(256)</div>
                <div class="field-desc">Single-line text input with standard string validation</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Text Area</div>
                <div class="field-type">text</div>
                <div class="field-desc">Multi-line text input for longer content</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Integer</div>
                <div class="field-type">numeric(24,0)</div>
                <div class="field-desc">Whole numbers with validation</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Number</div>
                <div class="field-type">decimal(24,6)</div>
                <div class="field-desc">Decimal numbers with precision</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Date</div>
                <div class="field-type">date</div>
                <div class="field-desc">Date picker with filtering capabilities</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">DateTime</div>
                <div class="field-type">timestamp/datetime</div>
                <div class="field-desc">Date and time picker</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Checkbox</div>
                <div class="field-type">boolean/bit</div>
                <div class="field-desc">Boolean values or multi-select options</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Drop Down</div>
                <div class="field-type">varchar(256)</div>
                <div class="field-desc">Single selection from predefined options</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">MultiSelect</div>
                <div class="field-type">varchar(256)</div>
                <div class="field-desc">Multiple selections stored as comma-separated values</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">User</div>
                <div class="field-type">numeric(19,0)</div>
                <div class="field-desc">Reference to portal_user table with search capabilities</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">File</div>
                <div class="field-type">numeric(19,0)</div>
                <div class="field-desc">File upload with FileLink integration</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Branch</div>
                <div class="field-type">numeric(19,0)</div>
                <div class="field-desc">Organizational hierarchy references</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">BelongsTo</div>
                <div class="field-type">numeric(19,0)</div>
                <div class="field-desc">Foreign key relationship to another tracker</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">HasMany</div>
                <div class="field-type">No column</div>
                <div class="field-desc">One-to-many relationship display</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">TreeNode</div>
                <div class="field-type">numeric(19,0)</div>
                <div class="field-desc">Hierarchical tree structure references</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">Hidden</div>
                <div class="field-type">varchar(256)</div>
                <div class="field-desc">Hidden form fields for system values</div>
            </div>
            
            <div class="field-item">
                <div class="field-name">FieldGroup</div>
                <div class="field-type">No column</div>
                <div class="field-desc">UI grouping element without data storage</div>
            </div>
        </div>
        
        <h3>Field Configuration Options</h3>
        
        <div class="integration-point">
            <h5>field_options</h5>
            <p>Groovy script that returns configuration for the field (dropdown options, user lists, etc.)</p>
        </div>
        
        <div class="integration-point">
            <h5>field_format</h5>
            <p>Display formatting rules for BelongsTo relationships and computed fields</p>
        </div>
        
        <div class="integration-point">
            <h5>field_default</h5>
            <p>Groovy script executed to set default values (access to session, curuser, sql)</p>
        </div>
        
        <div class="integration-point">
            <h5>hyperscript</h5>
            <p>Client-side scripting for dynamic UI behavior</p>
        </div>
    </div>

    <div class="container">
        <h2 id="workflow">6. Workflow & Transitions</h2>
        
        <h3>Workflow Architecture</h3>
        <p>PortalTracker implements a state machine pattern where records move between defined statuses through controlled transitions.</p>
        
        <div class="flow-diagram">
            <h4>Transition Flow Example</h4>
            <div class="flow-step">Draft</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Review</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Approved</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Published</div>
            <br><br>
            <div style="font-size: 0.9em; color: #666;">
                Each arrow represents a PortalTrackerTransition with specific role permissions
            </div>
        </div>
        
        <h3>Status Management</h3>
        <div class="info">
            <p><strong>PortalTrackerStatus</strong> defines the possible states a record can be in:</p>
            <ul class="feature-list">
                <li><span class="highlight">updateable</span> - Whether records in this status can be modified</li>
                <li><span class="highlight">attachable</span> - Whether files can be attached during updates</li>
                <li><span class="highlight">displayfields</span> - Which fields to show in this status</li>
                <li><span class="highlight">editfields</span> - Which fields can be edited in this status</li>
                <li><span class="highlight">emailonupdate</span> - Email template to send when status changes</li>
                <li><span class="highlight">updateallowedroles</span> - Role-based visibility for updates</li>
            </ul>
        </div>
        
        <h3>Transition Logic</h3>
        <div class="code-block">
// Transition enablement check (PortalTrackerTransition.groovy:121)
def testenabled(session, datas) {
    // Role validation
    if (this.roles) {
        def userroles = this.tracker.user_roles(curuser, datas)
        if (!userroles.intersect(this.roles)) {
            return false
        }
    }
    
    // Custom condition evaluation
    if (enabledcondition) {
        // Execute Groovy script with session and datas context
        return shell.evaluate(enabledcondition)
    }
    
    return true
}
        </div>
        
        <h3>Role-Based Permissions</h3>
        <p>PortalTrackerRole supports two types of role validation:</p>
        
        <div class="integration-point">
            <h5>User Role</h5>
            <p>Traditional role-based access using UserRole assignments or currentrole() matching</p>
        </div>
        
        <div class="integration-point">
            <h5>Data Compare</h5>
            <p>Dynamic role calculation based on data content using Groovy templates</p>
            <div class="code-block">
// Example: Owner-based access
${curuser.id == datas.owner_id ? 'true' : 'false'}

// Example: Department-based access  
${curuser.department == datas.department ? 'true' : 'false'}
            </div>
        </div>
    </div>

    <div class="container">
        <h2 id="integration">7. PortalPage Integration</h2>
        
        <p>PortalTracker integrates deeply with PortalPage for customizable UI rendering and post-processing logic.</p>
        
        <h3>Page Integration Points</h3>
        
        <div class="integration-point">
            <h5>postprocess (PortalTracker.groovy:123)</h5>
            <p>PortalPage executed after data updates with access to tracker, update, and mailService</p>
            <div class="code-block">
// Executed in PortalTrackerData.update() line 180
Binding binding = new Binding()
binding.setVariable("tracker", this.tracker)
binding.setVariable("update", this)  
binding.setVariable("mailService", mailService)
shell.evaluate(this.tracker.postprocess.content)
            </div>
        </div>
        
        <div class="integration-point">
            <h5>postprocess (PortalTrackerTransition.groovy:63)</h5>
            <p>PortalPage executed after transition completion</p>
            <div class="code-block">
// Executed in transition processing
Binding binding = new Binding()
binding.setVariable("session", session)
binding.setVariable("datas", curdatas)
binding.setVariable("curuser", curuser)
postoutput = shell.evaluate(ctrans.postprocess.content)
            </div>
        </div>
        
        <div class="integration-point">
            <h5>Email Templates (PortalTrackerEmail.groovy:35)</h5>
            <p>PortalPage used as email body template with GSP processing</p>
            <div class="code-block">
// Email body generation using PortalPage
def evalbody(datas, groovyPagesTemplateEngine) {
    Template template = groovyPagesTemplateEngine.createTemplate(
        this.body.content, location
    )
    template.make([datas:datas]).writeTo(bodyoutput)
}
            </div>
        </div>
        
        <h3>Automatic Page Generation</h3>
        <p>PortalTracker can automatically generate default pages for common operations:</p>
        
        <div class="code-block">
// PortalTrackerController.groovy:84-145
def create_default_pages(Long id) {
    // Creates pages based on templates:
    // - {slug}_list (from tracker_default_list)
    // - {slug}_show_{status} (from tracker_default_display)  
    // - {slug}_edit (from tracker_default_form)
    // - {slug}_{transition_name} (from tracker_default_form)
}
        </div>
        
        <h3>Dynamic Page Resolution</h3>
        <p>The system looks for pages in this priority order:</p>
        
        <div class="flow-diagram">
            <div class="flow-step">Specific Status</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Default View</div>
            <span class="flow-arrow">→</span>
            <div class="flow-step">Fallback Template</div>
        </div>
        
        <div class="code-block">
// Page resolution example (PortalTrackerController.groovy:779)
page = PortalPage.findByModuleAndSlug(
    tracker.module, 
    tracker.slug + "_show_" + status.name.toLowerCase()
)
if (!page) {
    page = PortalPage.findByModuleAndSlug(
        tracker.module, 
        tracker.slug + "_show_default"
    )
}
        </div>
    </div>

    <div class="container">
        <h2 id="data-management">8. Data Management</h2>
        
        <h3>Dynamic Schema Management</h3>
        <p>PortalTracker automatically creates and manages database schemas based on field definitions:</p>
        
        <div class="code-block">
// Database table creation (PortalTracker.groovy:284)
def updatedb(datasource) {
    // Create main data table
    if (!tableExists(data_table())) {
        sql.execute("""
            CREATE TABLE ${data_table()} (
                id SERIAL PRIMARY KEY,
                dataupdate_id NUMERIC(19,0) NULL,
                record_status VARCHAR(255) NULL  -- For non-DataStore types
            )
        """)
    }
    
    // Create audit trail table for Tracker type
    if (tracker_type == 'Tracker') {
        if (!tableExists(trail_table())) {
            sql.execute("""
                CREATE TABLE ${trail_table()} (
                    id SERIAL PRIMARY KEY,
                    record_id NUMERIC(19,0),
                    description TEXT,
                    update_date TIMESTAMP,
                    updater_id NUMERIC(19,0),
                    status VARCHAR(255),
                    changes TEXT,
                    allowedroles VARCHAR(255),
                    attachment_id NUMERIC(19,0)
                )
            """)
        }
    }
    
    // Add columns for each field
    this.fields.each { field ->
        field.updatedb(datasource)
    }
}
        </div>
        
        <h3>Data Import & Export</h3>
        <p><strong>PortalTrackerData</strong> handles Excel imports with intelligent field mapping:</p>
        
        <div class="integration-point">
            <h5>Automatic Header Detection</h5>
            <p>Uses LongestCommonSubsequence algorithm to match Excel headers with field names/labels</p>
        </div>
        
        <div class="integration-point">
            <h5>Batch Processing</h5>
            <p>PoiExcel integration for efficient processing of large datasets</p>
        </div>
        
        <div class="integration-point">
            <h5>Data Validation</h5>
            <p>Field-type specific validation during import with error reporting</p>
        </div>
        
        <div class="code-block">
// Excel processing example (PortalTrackerData.groovy:207)
def fromFileLink(manualmaps, otherparams, update_fields, ignore_fields, autosearch) {
    // 1. Find headers in Excel file
    def curheaders = poiExcel.findHeaders(file_path, statementfields)
    
    // 2. Match headers with field definitions
    curheaders.each { header ->
        def closest = findBestMatch(header, field.name, field.label)
        fileparams['datasource_' + field.id] = closest.col
    }
    
    // 3. Save mapping configuration
    this.savedparams = fileparams as JSON
}
        </div>
        
        <h3>Query & Search System</h3>
        <p>Advanced querying with security validation and parameterized queries:</p>
        
        <div class="code-block">
// Complex query parsing (PortalTracker.groovy:976)
def parseqparams(qparams, joiner='and') {
    qparams.each { key, value ->
        if (value instanceof String) {
            if (value.contains('%')) {
                query += "${key} ILIKE :${key}"
            } else if (value[0] in ['<', '>', '!']) {
                query += "${key} ${operator} :${key}"
            }
        } else if (value instanceof List) {
            // Handle array conditions with OR logic
            query += "(${arrayConditions.join(' OR ')})"
        }
    }
}

// Usage example:
def results = tracker.rows([
    'and': [
        name: '%john%',
        status: ['active', 'pending'],
        created_date: '>2023-01-01'
    ]
])
        </div>
        
        <h3>Indexing Strategy</h3>
        <p>Automatic index creation for search and filter fields:</p>
        
        <div class="integration-point">
            <h5>Search Field Indexes</h5>
            <p>Creates indexes for all fields in <code>searchfields</code> configuration</p>
        </div>
        
        <div class="integration-point">
            <h5>Filter Field Indexes</h5>
            <p>Creates indexes for all fields in <code>filterfields</code> configuration</p>
        </div>
        
        <div class="integration-point">
            <h5>Composite Indexes</h5>
            <p>When more than 2 fields are indexed, creates a combined index for optimal query performance</p>
        </div>
        
        <div class="integration-point">
            <h5>Custom Indexes</h5>
            <p>PortalTrackerIndex allows definition of custom composite indexes</p>
        </div>
    </div>

    <div class="container">
        <h2 id="security">9. Security & Access Control</h2>
        
        <h3>Multi-Layer Security Model</h3>
        
        <div class="warning">
            <strong>SQL Injection Protection:</strong> All queries use parameterized statements. The system validates and sanitizes all user inputs before query execution.
        </div>
        
        <h3>Access Control Levels</h3>
        
        <div class="integration-point">
            <h5>Tracker Level</h5>
            <p><span class="highlight">allowedroles</span> - Comma-separated list of roles that can access the tracker</p>
            <p><span class="highlight">anonymous_list/anonymous_view</span> - Allow anonymous access</p>
            <p><span class="highlight">require_login</span> - Force authentication</p>
        </div>
        
        <div class="integration-point">
            <h5>Status Level</h5>
            <p><span class="highlight">editroles</span> - Roles that can edit records in this status</p>
            <p><span class="highlight">updateallowedroles</span> - Control audit trail visibility</p>
        </div>
        
        <div class="integration-point">
            <h5>Transition Level</h5>
            <p><span class="highlight">roles</span> - Roles required to perform this transition</p>
            <p><span class="highlight">enabledcondition</span> - Dynamic validation logic</p>
        </div>
        
        <div class="integration-point">
            <h5>Field Level</h5>
            <p><span class="highlight">is_encrypted</span> - Automatic field encryption using CryptoUtilsFile</p>
            <p><span class="highlight">role_query</span> - Field visibility based on roles</p>
        </div>
        
        <h3>Role Resolution Process</h3>
        <div class="code-block">
// Role resolution (PortalTracker.groovy:711)
def user_roles(curuser, datas=null) {
    def roles = []
    
    this.roles.each { role ->
        if (role.name == 'Admin' && checkAdmin(curuser)) {
            roles << role
        } else if (role.role_type == 'User Role') {
            // Check UserRole assignments and currentrole()
            if (curuser.currentrole()?.role == role.name) {
                roles << role
            }
        } else if (role.role_type == 'Data Compare') {
            // Execute dynamic role evaluation
            def query = buildDataCompareQuery(role, curuser, datas)
            if (sql.firstRow(query)) {
                roles << role
            }
        }
    }
    
    return roles
}
        </div>
        
        <h3>Data Filtering</h3>
        <p>Security-based data filtering automatically applied to all queries:</p>
        
        <div class="code-block">
// Automatic security filtering (PortalTracker.groovy:1860)
def listquery(params, curuser, select="SELECT *") {
    def conditions = []
    
    // Apply user role filters
    if (curuser) {
        if (this.module_roles(curuser).size()) {
            // User has module-level access - no additional filtering
        } else {
            // Apply data-level role queries
            def roleQueries = this.role_query(curuser)
            if (roleQueries) {
                conditions << "(" + roleQueries.join(' OR ') + ")"
            }
        }
    } else if (!this.anonymous_list) {
        // Block anonymous access
        conditions << "1 != 1"
    }
    
    return buildQuery(conditions)
}
        </div>
        
        <h3>Encryption Support</h3>
        <div class="info">
            <p>Fields marked with <code>is_encrypted = true</code> are automatically encrypted/decrypted:</p>
            <ul class="feature-list">
                <li><strong>Storage:</strong> CryptoUtilsFile.encrypt() during save operations</li>
                <li><strong>Retrieval:</strong> CryptoUtilsFile.decrypt() during display</li>
                <li><strong>Key Management:</strong> Configured via config.encryption.key</li>
                <li><strong>Transparent:</strong> Application code doesn't need encryption awareness</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 id="api">10. API & Services</h2>
        
        <h3>Service Layer</h3>
        <p>PortalTrackerService provides standard GORM service methods:</p>
        
        <div class="code-block">
// Standard service methods (PortalTrackerService.groovy)
interface PortalTrackerService {
    PortalTracker get(Serializable id)
    Long count()
    List&lt;PortalTracker&gt; list(Map args)
    
    // Query-based methods with module filtering
    Long count(String query, String module)
    List&lt;PortalTracker&gt; list(String query, ArrayList modules, Map args)
    
    void delete(Serializable id)
    PortalTracker save(PortalTracker portalTracker)
}
        </div>
        
        <h3>Static Helper Methods</h3>
        <p>PortalTracker provides static methods for programmatic access:</p>
        
        <div class="code-block">
// Static data access methods
def tracker = PortalTracker.load_tracker('portal:users')
def value = PortalTracker.get_value('portal:users:123', 'name')
def data = PortalTracker.getdatas('portal', 'users', 123)

// Query methods
def rows = PortalTracker.load_rows('portal', 'users', [
    status: 'active',
    department: 'IT'
])

// Raw SQL access (use with caution)
def result = PortalTracker.raw_firstRow("""
    SELECT COUNT(*) as total 
    FROM trak_portal_users_data 
    WHERE status = :status
""", [status: 'active'])
        </div>
        
        <h3>Data Manipulation API</h3>
        <div class="code-block">// Create new record
def tracker = PortalTracker.findByModuleAndSlug('portal', 'users')
def newData = tracker.savedatas([
    name: 'John Doe',
    email: 'john@example.com',
    department: 'IT'
])

// Update existing record  
def updatedData = tracker.savedatas([
    id: 123,
    name: 'John Smith',
    status: 'active'
])

// Add audit trail entry (Tracker type only)
def trailId = tracker.savetrail(
    123,                    // record_id
    'Updated user profile', // description
    currentUser,            // user
    'active',              // status
    session,               // session
    request                // request
)</div>
        
        <h3>Excel Integration API</h3>
        <div class="code-block">// Create data import
def dataImport = new PortalTrackerData(
    tracker: tracker,
    file_link: uploadedFile,
    header_start: 1,
    header_end: 1,
    data_row: 2
)

// Auto-map fields
dataImport.fromFileLink(
    [name: 'A', email: 'B'],  // manual mappings
    null,                      // other params
    ['name', 'email'],         // update fields
    ['id'],                    // ignore fields  
    true                       // auto-search headers
)

// Process the import
dataImport.update(mailService)</div>
        
        <h3>Controller Actions</h3>
        <p>Key controller endpoints for integration:</p>
        
        <div class="integration-point">
            <h5>/portalTracker/list</h5>
            <p>Lists tracker data with filtering, paging, and security validation.</p>
        </div>
        
        <div class="integration-point">
            <h5>/portalTracker/display_data/{id}</h5>
            <p>Shows individual record with status-specific page rendering and field visibility controls.</p>
        </div>
        
        <div class="integration-point">
            <h5>/portalTracker/create_data</h5>
            <p>Creates new records with initial status assignment and field validation.</p>
        </div>
        
        <div class="integration-point">
            <h5>/portalTracker/transition_submit</h5>
            <p>Processes status transitions with role validation, field updates, and email notifications.</p>
        </div>
        
        <div class="integration-point">
            <h5>/portalTracker/api_list</h5>
            <p>JSON API endpoint for external system integration with role-based data filtering.</p>
        </div>
    </div>

    <div class="container">
        <h2 id="best-practices">11. Best Practices</h2>
        
        <h3>Tracker Design</h3>
        <div class="info">
            <ul class="feature-list">
                <li><strong>Naming:</strong> Use descriptive, URL-friendly slugs (e.g., 'employee_requests', 'project_milestones')</li>
                <li><strong>Modules:</strong> Group related trackers by module for better organization</li>
                <li><strong>Type Selection:</strong> Choose the minimal tracker type for your needs (DataStore < Statement < Tracker)</li>
                <li><strong>Initial Status:</strong> Always set an appropriate initial status for Tracker types</li>
            </ul>
        </div>
        
        <h3>Field Configuration</h3>
        <div class="info">
            <ul class="feature-list">
                <li><strong>Field Names:</strong> Use snake_case for database compatibility</li>
                <li><strong>Labels:</strong> Provide clear, user-friendly labels</li>
                <li><strong>Search Fields:</strong> Limit to essential fields to avoid performance issues</li>
                <li><strong>Indexing:</strong> Create indexes for frequently filtered fields</li>
                <li><strong>Encryption:</strong> Only encrypt truly sensitive data due to performance impact</li>
            </ul>
        </div>
        
        <h3>Workflow Design</h3>
        <div class="info">
            <ul class="feature-list">
                <li><strong>Linear Flows:</strong> Design simple, linear workflows when possible</li>
                <li><strong>Role Granularity:</strong> Balance security needs with usability</li>
                <li><strong>Error Handling:</strong> Use try-catch blocks in custom Groovy scripts</li>
                <li><strong>Testing:</strong> Test all transition paths and role combinations</li>
                <li><strong>Documentation:</strong> Document complex enabledcondition logic</li>
            </ul>
        </div>
        
        <h3>Performance Optimization</h3>
        <div class="info">
            <ul class="feature-list">
                <li><strong>Query Optimization:</strong> Use specific filters and avoid broad searches</li>
                <li><strong>Index Management:</strong> Monitor and optimize index usage</li>
                <li><strong>Caching:</strong> Leverage built-in domain caching (cache: true)</li>
                <li><strong>Lazy Loading:</strong> Use pagination for large datasets</li>
                <li><strong>Background Processing:</strong> Use PortalTrackerData for bulk operations</li>
            </ul>
        </div>
        
        <h3>Security Guidelines</h3>
        <div class="info">
            <ul class="feature-list">
                <li><strong>Role Validation:</strong> Always validate roles at multiple levels</li>
                <li><strong>Input Sanitization:</strong> Never bypass parameter binding</li>
                <li><strong>Audit Trails:</strong> Use Tracker type for sensitive data</li>
                <li><strong>Access Logging:</strong> Monitor access patterns via PortalErrorLog</li>
                <li><strong>Encryption Keys:</strong> Properly secure encryption key files</li>
            </ul>
        </div>
        
        <h3>Integration Patterns</h3>
        <div class="code-block">
// Recommended integration patterns

// 1. Service-Layer Integration
class MyService {
    def processUserRequest(params) {
        def tracker = PortalTracker.load_tracker('portal:user_requests')
        def requestId = tracker.savedatas(params)
        
        // Trigger workflow
        if (params.auto_approve) {
            tracker.savetrail(requestId, 'Auto-approved', systemUser, 'approved')
        }
        
        return requestId
    }
}

// 2. Event-Driven Integration  
class MyController {
    def afterSave = { record ->
        // Trigger tracker workflow from domain events
        def tracker = PortalTracker.load_tracker('audit:data_changes')
        tracker.savedatas([
            table_name: record.class.simpleName,
            record_id: record.id,
            action: 'CREATE',
            timestamp: new Date()
        ])
    }
}

// 3. API Integration
class APIController {
    def submitRequest() {
        def tracker = PortalTracker.findBySlug(params.tracker_slug)
        
        // Validate API access
        if (!tracker.anonymous_list && !session.user) {
            render status: 401, text: 'Authentication required'
            return
        }
        
        def result = tracker.savedatas(params.data)
        render contentType: 'application/json', text: result as JSON
    }
}
        </div>
    </div>

    <div class="container">
        <h2 id="troubleshooting">12. Troubleshooting</h2>
        
        <h3>Common Issues</h3>
        
        <div class="warning">
            <h5>Database Table Not Created</h5>
            <p><strong>Symptom:</strong> "Table doesn't exist" errors</p>
            <p><strong>Solution:</strong> Call <code>tracker.updatedb(dataSource)</code> or save the tracker to trigger schema creation</p>
        </div>
        
        <div class="warning">
            <h5>Field Not Appearing in Database</h5>
            <p><strong>Symptom:</strong> New fields not showing in queries</p>
            <p><strong>Solution:</strong> Save the PortalTrackerField to trigger <code>updatedb()</code></p>
        </div>
        
        <div class="warning">
            <h5>Role Access Denied</h5>
            <p><strong>Symptom:</strong> Users can't see data they should access</p>
            <p><strong>Solution:</strong> Check role assignments, Data Compare rules, and module permissions</p>
        </div>
        
        <div class="warning">
            <h5>Transition Not Available</h5>
            <p><strong>Symptom:</strong> Expected transitions not showing</p>
            <p><strong>Solution:</strong> Verify role permissions, enabledcondition logic, and prev_status configuration</p>
        </div>
        
        <div class="warning">
            <h5>Excel Import Failing</h5>
            <p><strong>Symptom:</strong> Upload process errors or no data imported</p>
            <p><strong>Solution:</strong> Check field mappings, data types, and header row configuration</p>
        </div>
        
        <h3>Debugging Tools</h3>
        
        <div class="integration-point">
            <h5>PortalErrorLog Integration</h5>
            <p>All errors are automatically logged with context information</p>
            <div class="code-block">
// Manual error logging
PortalErrorLog.record(
    params,           // request parameters
    curuser,         // current user  
    'tracker',       // component
    'operation',     // operation name
    e.toString(),    // error message
    tracker.slug,    // slug
    tracker.module   // module
)
            </div>
        </div>
        
        <div class="integration-point">
            <h5>Debug Settings</h5>
            <p>Enable debug output for data operations</p>
            <div class="code-block">
// In PortalSetting
debug_dataupdate = 1  // Enable data update debugging
emailrolepageerror = 'admin@company.com'  // Role error notifications
emailpageerror = 'admin@company.com'      // Page error notifications
            </div>
        </div>
        
        <h3>Performance Troubleshooting</h3>
        
        <div class="integration-point">
            <h5>Slow Queries</h5>
            <p>Monitor index usage and query patterns</p>
            <div class="code-block">
// Check index creation
tracker.createIndex(dataSource)

// Verify search field configuration
println "Search fields: ${tracker.searchfields}"
println "Filter fields: ${tracker.filterfields}"

// Monitor query performance
def startTime = System.currentTimeMillis()
def results = tracker.rows(queryParams)
def duration = System.currentTimeMillis() - startTime
println "Query took: ${duration}ms"
            </div>
        </div>
        
        <div class="integration-point">
            <h5>Memory Issues</h5>
            <p>Large dataset handling</p>
            <div class="code-block">
// Use pagination for large datasets
def results = tracker.rows(
    queryParams,
    'id ASC',        // order
    offset,          // starting position
    limit            // page size
)

// Batch processing for imports
dataImport.data_end = startRow + batchSize
dataImport.update(mailService)
            </div>
        </div>
        
        <h3>Development Workflow</h3>
        
        <div class="code-block">
// Development checklist
1. Design tracker schema and workflow
2. Create PortalTracker instance
3. Add PortalTrackerField definitions  
4. Configure PortalTrackerStatus states
5. Setup PortalTrackerTransition rules
6. Test role assignments and permissions
7. Create/customize PortalPage templates
8. Configure email notifications
9. Test Excel import/export functionality
10. Performance test with realistic data volumes
        </div>
        
        <div class="info">
            <strong>Testing Strategy:</strong>
            <ul class="feature-list">
                <li>Test all user roles and permission combinations</li>
                <li>Validate all transition paths and business rules</li>
                <li>Test with realistic data volumes</li>
                <li>Verify email notifications and templates</li>
                <li>Test Excel import with various file formats</li>
                <li>Performance test queries and bulk operations</li>
            </ul>
        </div>
    </div>

    <div class="container" style="text-align: center; margin-top: 50px; padding: 40px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 10px;">
        <h2 style="color: #007bff; margin-bottom: 20px;">Documentation Complete</h2>
        <p style="font-size: 1.1em; color: #495057; margin-bottom: 30px;">
            This comprehensive guide covers all aspects of the PortalTracker domain system.
            For additional support or questions, consult the source code references provided throughout this document.
        </p>
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <p style="margin: 0; font-style: italic; color: #6c757d;">
                Generated from comprehensive analysis of G6Portal PortalTracker domain<br>
                Source files: 32 domain classes, controllers, and services analyzed
            </p>
        </div>
    </div>
</body>
</html>